<div class="m-4 text-xl uppercase border-b border-black/[0.24] pb-3">
  Creation espace
</div>
<div class="m-6">
  <mat-stepper class="shadow-2xl rounded-xl overflow-auto" #stepper>
    <mat-step [stepControl]="firstFormGroup">
      <form [formGroup]="firstFormGroup">
        <ng-template matStepLabel>Membre de l'espace</ng-template>
        <div class="flex gap-2 border-b pb-3">
          <div class="flex items-center justify-center font-medium underline">
            Etape 1:
          </div>
          <div class="italic">Choix des membres</div>
        </div>
        <div class="overflow-x-auto mt-3">
          <table class="table w-full">
            <thead>
              <tr>
                <th *ngFor="let item of membre">{{ item.libelle }}</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <select
                    class="select select-bordered w-full max-w-xs"
                    formControlName="etudiant"
                  >
                    <option disabled selected>Etudiant</option>
                    <option
                      *ngFor="let et of theseList"
                      [value]="et.ID_UTILISATEUR"
                    >
                      {{ et.ETUDIANT }}
                    </option>
                  </select>
                </td>
                <td>
                  <select
                    class="select select-bordered w-full max-w-xs"
                    formControlName="admin"
                  >
                    <option disabled selected>Admin</option>
                    <option *ngFor="let ad of adminList" [value]="ad.id_user">
                      {{ ad.nom }}
                    </option>
                  </select>
                </td>
                <td>
                  <select
                    formControlName="directeur"
                    class="select select-bordered w-full max-w-xs"
                  >
                    <option disabled selected>Directeur</option>
                    <option *ngFor="let ad of prof" [value]="ad.id_user">
                      {{ ad.nom }}
                    </option>
                  </select>
                </td>
                <td>
                  <select
                    formControlName="rapporteur"
                    class="select select-bordered w-full max-w-xs"
                  >
                    <option disabled selected>Rapporteur</option>
                    <option *ngFor="let ad of prof" [value]="ad.id_user">
                      {{ ad.nom }}
                    </option>
                  </select>
                </td>
                <td>
                  <select
                    formControlName="jury1"
                    class="select select-bordered w-full max-w-xs"
                  >
                    <option disabled selected>1er Jury</option>
                    <option *ngFor="let ju of jury" [value]="ju.id_user">
                      {{ ju.nom }}
                    </option>
                  </select>
                </td>
                <td>
                  <select
                    formControlName="jury2"
                    class="select select-bordered w-full max-w-xs"
                  >
                    <option disabled selected>2e Jury</option>
                    <option *ngFor="let ju of jury" [value]="ju.id_user">
                      {{ ju.nom }}
                    </option>
                  </select>
                </td>
                <td>
                  <select
                    formControlName="anonyme"
                    class="select select-bordered w-full max-w-xs"
                  >
                    <option disabled selected>Anonyme</option>
                    <option *ngFor="let ad of prof" [value]="ad.id_user">
                      {{ ad.nom }}
                    </option>
                  </select>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="flex gap-2 border-b mt-10 pb-3">
          <div class="flex items-center justify-center font-medium underline">
            Etape 2:
          </div>
          <div class="italic">Configuration des taches</div>
        </div>
        <div class="overflow-x-auto mt-3">
          <table class="table w-full">
            <thead>
              <tr>
                <th>Tache</th>
                <th>Date début</th>
                <th>Date fin</th>
                <th>Alarme</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let td of tasks">
                <td>{{ td.ID_UTILISATEUR }}</td>
                <td>
                  <div class="flex border">
                    <input
                      [(ngModel)]="td.DATE_DEBUT"
                      [ngModelOptions]="{ standalone: true }"
                      class="border-t p-1"
                      matInput
                      [matDatepicker]="picker"
                      name="debut"
                    />
                    <mat-datepicker-toggle
                      matSuffix
                      [for]="picker"
                    ></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                  </div>
                </td>
                <td>
                  <div class="flex border">
                    <input
                      [ngModelOptions]="{ standalone: true }"
                      [(ngModel)]="td.DATE_FIN"
                      class="border-t p-1"
                      matInput
                      [matDatepicker]="picker2"
                      name="fin"
                    />
                    <mat-datepicker-toggle
                      matSuffix
                      [for]="picker2"
                    ></mat-datepicker-toggle>
                    <mat-datepicker #picker2></mat-datepicker>
                  </div>
                </td>
                <td>
                  <select
                    [(ngModel)]="td.ID_ALARME"
                    [ngModelOptions]="{ standalone: true }"
                    class="select select-bordered w-full max-w-xs"
                  >
                    <option disabled selected>Alarme</option>
                    <option
                      *ngFor="let alarme of reminderList"
                      [value]="alarme.ID_ALARME"
                    >
                      {{ alarme.LIBELLE }}
                    </option>
                  </select>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="mt-3">
          <button
            class="border w-[100px] bg-green-700 text-white shadow-xl rounded-lg"
            mat-button
            matStepperNext
            (click)="submitStep()"
          >
            Next
          </button>
        </div>
      </form>
    </mat-step>
    <mat-step [stepControl]="secondFormGroup">
      <form [formGroup]="secondFormGroup">
        <ng-template matStepLabel>Distribution des taches</ng-template>
        <div>
          Espace:
          <select
            class="select select-bordered w-full max-w-xs"
            (change)="getDetailEspace($event)"
          >
            <option disabled selected>Espace</option>
            <option 
              *ngFor="let esp of espaceList"
              [value]="esp.ID_ESPACE"
            >
              {{ esp.ID_ESPACE+' - '+esp.NOM }}
            </option>
          </select>
        </div>
        <div class="flex gap-3 min-h-[550px] mt-3">
          <div class="w-[25%] shadow-2xl border rounded-xl bg-[#EDC7B7]">
            <div
              class="text-center flex flex-col w-full text-[20px] h-[10%] border-b border-black/[0.24]"
            >
              <div
                class="flex gap-2 justify-center items-center text-[#123C69]"
              >
                <mat-icon>description</mat-icon>
                Attribution de tâches
              </div>
              <span class="font-thin text-[13px] text-black/[0.5] italic"
                >Veuillez déposez les responsables ici</span
              >
            </div>
            <select
              class="select select-bordered w-[80%] max-w-xs font-medium h-[5%] mt-2 ml-2"
              [(ngModel)]="taskTraite"
              [ngModelOptions]="{ standalone: true }"
            >
              <option disabled selected>Veuillez choisir une tache</option>
              <option *ngFor="let task of tasks" [ngValue]="task">
                {{ task.ID_TACHED }}
              </option>
            </select>
            <div
              class="h-[70%] m-2 rounded-md bg-white"
              cdkDropList 
              #choisi="cdkDropList"
              [cdkDropListData]="membreChoisi"
              [cdkDropListConnectedTo]="[listmembre]"
              (cdkDropListDropped)="drop($event)"
            >
              <div
                *ngFor="let m of membreChoisi"
                class="text-[15px] p-3 w-full border-b"
                cdkDrag
              >
                {{ m.NOM }}
              </div>
            </div>

            <div class="h-[5%] w-full relative">
              <button
                class="bg-red-500 text-white rounded-md w-[100px] absolute right-2.5 drop-shadow-xl"
                (click)="addToList()"
              >
                Valider
              </button>
            </div>
          </div>
          <div class="w-[25%] shadow-2xl border rounded-xl bg-[#EEE2DC]">
            <div
              class="text-center w-full flex flex-col text-[19px] p-2 border-b border-black/[0.24]"
            >
              <div class="flex gap-2 justify-center items-center">
                <mat-icon>people icon</mat-icon>
                Liste des Membres
              </div>
              <span class="font-thin text-[13px] text-black/[0.5] italic"
                >Glissez les responsable dans la première colonne</span
              >
            </div>
            <div class="overflow-x-auto m-2">
              <table class="table w-full">
                <thead>
                  <tr>
                    <th>Membre</th>
                    <th>Role</th>
                  </tr>
                </thead>
                <tbody
                  cdkDropList
                  #listmembre="cdkDropList"
                  [cdkDropListData]="membres"
                  [cdkDropListConnectedTo]="[choisi]"
                  (cdkDropListDropped)="drop($event)"
                >
                  <tr
                    *ngFor="let m of membres"
                    class="text-[13px] w-full"
                    cdkDrag
                  >
                    <td>{{ m.NOM }}</td>
                    <td>{{ m.ROLE }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="w-[50%] shadow-2xl border rounded-xl bg-[#BAB2B5]">
            <div
              class="text-center w-full text-[20px] p-4 uppercase text-black/[0.5] border-b border-black/[0.24]"
            >
              Recapitulation
            </div>
            <div class="overflow-auto m-2">
              <table class="table w-full">
                <thead>
                  <tr>
                    <th>Tache</th>
                    <th class="flex flex-col items-center">
                      Membre
                      <span
                        class="font-thin text-[12px] text-black/[0.5] italic capitalize"
                        >Choisir le 1er responsable en cliquant sur le
                        bouton</span
                      >
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let m of executeur" class="text-[15px] w-full">
                    <td>
                      {{ m.tache.ID_TACHED }}
                    </td>
                    <td
                      class="border-l border-black/[0.24]"
                      style="padding: 0 !important"
                    >
                      <div
                        class="border-b w-full p-4 relative"
                        *ngFor="let ex of m.executeur"
                      >
                        {{ ex.libelle }}
                        <mat-radio-button
                          class="absolute right-0"
                          (change)="setResponsable(m, ex)"
                        ></mat-radio-button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="mt-3">
          <button
            class="border w-[100px] bg-red-700 text-white shadow-xl rounded-lg"
            mat-button
            matStepperPrevious
            (click)="backBtn()"
          >
            Back
          </button>
          <button
            class="border w-[100px] bg-green-700 ml-3 text-white shadow-xl rounded-lg"
            mat-button
            matStepperNext
            (click)="submitExecuteur()"
          >
            Next
          </button>
        </div>
      </form>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel>Done</ng-template>
      <p>You are now done.</p>
      <div class="mt-3">
        <button
          class="border w-[100px] bg-red-700 text-white shadow-xl rounded-lg"
          mat-button
          matStepperPrevious
        >
          Back
        </button>
        <button
          class="border w-[100px] bg-green-700 text-white shadow-xl rounded-lg"
          mat-button
        >
          Preview
        </button>
      </div>
    </mat-step>
  </mat-stepper>
</div>
